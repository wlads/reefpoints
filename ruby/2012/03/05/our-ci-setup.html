<!DOCTYPE html><html><head><title>Our Continuous Integration Setup</title><link href="/stylesheets/all-da69096f.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all-ce68a29a.js" type="text/javascript"></script><meta content='NO-CACHE' http-equiv='CACHE-CONTROL'><meta content='DockYard is a Ruby on Rails, PostgreSQL, and, Ember.js, web / mobile application development software consultancy based in Boston, MA.' namer='description'><meta content='ruby on rails, rails, ruby, ruby on rails training, ruby application development, ruby on rails application development, ember application development, ember.js application development, software application development, web, web application development, mobile, mobile application development, ios, ios application development, iphone, iphone application development, android, android application development, postgres, startups, enterprise, Boston, MA, Massachusetts, for hire' name='keywords'><meta content='web development, mobile development, startups, enterprise, ruby on rails, rails, ruby, ruby on rails training, Boston, for hire' name='keywords'><meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0' name='viewport'><meta charset='utf-8'><meta content='DockYard.com - What we are doing to keep our developers honest with their tests' name='description'><link href='https://plus.google.com/102648938707671188640' rel='author'><meta content='_danmcclain' name='twitter:creator'><meta content='summary' name='twitter:card'><meta content='@DockYard' name='twitter:site'><meta content='http://reefpoints.dockyard.com/ruby/2012/03/05/our-ci-setup.html' name='twitter:url'><meta content='Our Continuous Integration Setup' name='twitter:title'><meta content='What we are doing to keep our developers honest with their tests' name='twitter:description'><link href='//cloud.typography.com/6496052/702882/css/fonts.css' rel='stylesheet' type='text/css'><link href='http://dockyard.com/humans.txt' rel='author'><link href='/favicon-573a5e34.png' rel='shortcut icon' type='image/x-icon'><link href='/favicon-573a5e34.png' rel='icon' type='image/x-icon'><link href='/apple-touch-icon.png' rel='apple-touch-icon'><link href='/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'><script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24185112-2']);
    _gaq.push(['_trackPageview']);
  
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
<!--
                                             ..
                                           .O.
                                       .:OO.
                                      :OOO.
                                    :OOO:.
                         ...      :OOOO:
                   ..ZOOOOOOOOO..OZ.O.
                   OOOOOOOOOOOOOOOOI
                  OOOOOOOOOOOOOOOOI,
                 OOOOOOOO. .OOOOOOOO:
                 OOOOOOOO   OOOOOOOOO:
                OOOOOOOOOOOOOOOOOOOOO.
                OOOOOOOOOOOOOOOOOOOOO:
               .OOOOOOOOOOOOOOOOOOOOO:
               .OOOOOOOOOOOOOOOOOOOOO.
                OOOOOOOOOOOOOOOOOOOOO
                OOOOOO?:   .OOOOOOOOO
               .OOOOO      OOOOOOOOOO
,OO ZO,        OOOOO,     OOOOOOOOOO+
 OOOOO.        OOOOO     OOOOOOOOOOO+
  OOO?        OOOOO     .OOOOOOOOOOO:
   OOO,      OOOOO.    .OOOOOOOOOOOO
    OOOOOOOOOOOOO.    .OOOOOOOOOOOO.
     OOOOOOOOOOOO.  .OOOOOOOOOOOOO.
      8OOOOOOOOOOOOOOOOOOOOOOOODO:
         :OOOOOOOOOOOOOOOOOOOO::

--></head><body class='ruby ruby_2012 ruby_2012_03 ruby_2012_03_05 ruby_2012_03_05_our-ci-setup'><header><div class='extended-nav-wrap'><div class='l-wrap--wide'><nav class='extended-nav'><a class="extended-nav--logo" data-icon="⌂" href="http://dockyard.com/"><span class='is-hidden'>Home</span></a>
<a class="extended-nav--close" data-icon="X" href="#"><span class='is-hidden'>Close</span></a><div class='extended-nav__items'><div class='extended-nav__items--mobile'><a class="extended-nav__item--work extended-nav__item" href="#">Work</a><nav class='work-nav--mobile'><a href="http://dockyard.com/work/credit-card-reviews" class="work-nav-item"><strong class='work-nav-item__title'>Credit Card Reviews</strong></a>
<a href="http://dockyard.com/work/coachup" class="work-nav-item"><strong class='work-nav-item__title'>CoachUp</strong></a>
<a href="http://dockyard.com/work/askthem" class="work-nav-item"><strong class='work-nav-item__title'>AskThem</strong></a>
<a href="http://dockyard.com/work/beacon-hill-blitz" class="work-nav-item"><strong class='work-nav-item__title'>Beacon Hill Blitz</strong></a></nav></div><a class="extended-nav__item" href="http://dockyard.com/team">Our Team</a><a class="extended-nav__item" href="http://dockyard.com/process">Process</a><a class="extended-nav__item" href="http://dockyard.com/community">Community</a><a class="extended-nav__item active" href="/">Blog</a><a class="extended-nav__item" href="http://dockyard.com/hire-us">Hire Us</a></div></nav><nav class='work-nav'><h6>Selected Work</h6><a href="http://dockyard.com/work/credit-card-reviews" class="work-nav-item"><strong class='work-nav-item__title'>Credit Card Reviews</strong><p>Credit card advice from real people.</p></a>
<a href="http://dockyard.com/work/coachup" class="work-nav-item"><strong class='work-nav-item__title'>CoachUp</strong><p>You should be training. Right now.</p></a>
<a href="http://dockyard.com/work/askthem" class="work-nav-item"><strong class='work-nav-item__title'>AskThem</strong><p>Ask officials questions on city, state, and federal levels.</p></a>
<a href="http://dockyard.com/work/beacon-hill-blitz" class="work-nav-item"><strong class='work-nav-item__title'>Beacon Hill Blitz</strong><p>How technology helped repeal the #TechTax.</p></a></nav></div></div><nav class='main-nav-wrap'><div class='main-nav l-wrap--wide'><a class="logo" href="http://dockyard.com">DockYard</a><a class="club-sandwich" data-icon="☰" href="#"><span class='is-hidden'>Navigation</span></a></div></nav></header><div class='push--header'></div><div class='l-wrap--blog'><a href="/"><strong class='logo--blog'>ReefPoints</strong><strong class='logo--blog__tagline'>Blog</strong></a><nav class='blog-nav'><a class="blog-nav__item " href="/">Posts</a><a class="blog-nav__item " href="/categories.html">Categories</a><a class="blog-nav__item " href="/authors.html">Authors</a></nav></div><div class='l-wrap--blog__post'><h1 class='post__title'>Our Continuous Integration Setup</h1><a class="post__author" href="/authors/dan-mcclain.html">Dan McClain</a><time class='post__date'>March 5<sup>th</sup>, 2012</time><div class='post__content'><p>When I started at DockYard, Brian tasked me with setting up a continous
integration (CI) server so that we could keep an eye on our RSpec test
suite. We went with Jenkins since we are writing client code, so
<a href="http://travis-ci.org">travis-ci.org</a> is out of the question (for now).</p>

<p>Our CI server is running on Ubuntu 10.04. We are using nginx as a
reverse proxy infront of our Jenkins server. Our basic setup is the same
as <a href="http://bostonrb.org/presentations/jenkins-rails">the presentation I gave at Boston RB in January</a>.
There are a few upgrades I have made since then.  First, I set up the
GitHub authentication plugin. The other plugin I installed was the
Campfire notification plugin. Since we are all remote, we use Campfire
as our main line of communication. Having Jenkins notify us in Campfire
allows us to see when new code is pushed to master, and when someone
breaks the build.</p>

<h2>RSpec HTML formatter + Jenkins = Every Build is successful (even when it isn&#39;t)</h2>

<p>As we found out the hard way, using the RSpec HTML formatter from within
jenkins is not the best idea.  The problem is the HTML formatter returns
the same exit code regardless of whether or not the suite passes. This
is a huge problem, as you end up with false positives.</p>

<h2>Enter ci_reporter</h2>

<p>The <a href="https://github.com/nicksieger/ci_reporter">ci_reporter</a> gem provides a rake
task that generates a set of xml reports that Jenkins can interpret and
give us a more complete picture of our test suite. Jenkins will plot the
number of failure over time, display test duration, and provide a number 
of other stats you can utilize. </p>

<h2>Capybara-webkit + Xvfb + headless = Javascript without opening a browser</h2>

<p>We are using capybara to run our <a href="http://railscasts.com/episodes/257-request-specs-and-capybara">request
specs</a>.
When our request spec needs javascript, we use 
<a href="https://github.com/thoughtbot/capybara-webkit">Capybara-webkit</a> as our
javascript driver. Capybara-webkit is a
webkit capybara driver, allowing you to run javascript in a headless
webkit instance.  It accomplishes this by using QtWebKit. On Ubuntu, to
utilize capybara-webkit, you need an X Server running when you run your
test.  To accomplish this, I installed Xvfb, which will create a
virtual framebuffer.  To instantiate xvfb, I used the headless
gem, which is a ruby wrapper for xvfb.  With headless, I don&#39;t have to
do any bash scripting to get a framebuffer ready before we run our
tests. </p>

<p>I added the following code to our <code>spec_helper.rb</code> file</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre>config.before(<span class="symbol">:suite</span>) <span class="keyword">do</span>
  <span class="instance-variable">@headless</span> = <span class="constant">Headless</span>.new
  <span class="instance-variable">@headless</span>.start
<span class="keyword">end</span>

config.after(<span class="symbol">:suite</span>) <span class="keyword">do</span>
  <span class="instance-variable">@headless</span>.destroy
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>The above spippet creates the headless instance and creates the
framebuffer at the beginning of the test suite, and destorys it
afterwards.</p>

<h2>Conclusion</h2>

<p>Overall, I&#39;m pretty happy with our set up as it is. The one issue I have
with it is the way ci_reporter and jenkins interact. Since Jenkins was
origianlly built for Java, builds are BROKEN when they don&#39;t build, but
UNSTABLE when their tests fail.  UNSTABLE builds are seen as successful.
I would rather an UNSTABLE build be seen as a failure, since the
campfire notification plugin plays the same sound for successful and
unstable builds.  I may poke around with the plugin or ci_reporter to
have jenkins notify us of builds in a way that makes more sense.</p>
</div><div class='post__share'><a class='twitter-share-button' data-url='http://reefpoints.dockyard.com/ruby/2012/03/05/our-ci-setup.html' data-via='DockYard' href='https://twitter.com/share'>Tweet</a><script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='//platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');
</script><div class='g-plusone' data-href='#' data-size='medium' data-width='100'></div><script>
  (function() {var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;po.src = 'https://apis.google.com/js/plusone.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();
</script><span class='post__share--github'>If you see an issue, please send a <a href='https://github.com/dockyard/reefpoints/blob/master/source/posts/', class='text-link post__issue', target: '_blank'>pull request</a> to contribute.</span></div><div class='related-posts-wrap'><div class='post__avatar-wrap'><img class='post__avatar' src='/images/team/dan-mcclain.jpg'><h5 class='post__avatar__name'>Dan McClain</h5><h5 class='post__avatar__position headline--sub'>Partner &amp; Developer<br>At DockYard
</h5></div><div class='related-posts'><h3 class='related-posts__header headline--sub'>Other posts by Dan</h3><a class="related-post" href="/2014/02/07/native-app-developers-we-can-help-you.html"><h2 class='related-post__title'>Native App Developers: We Can Help You</h2><p>February 7<sup>th</sup>, 2014</p></a>
<a class="related-post" href="/2014/02/07/announcing-postgres_ext-postgis.html"><h2 class='related-post__title'>Announcing PostgresExt-PostGIS</h2><p>February 7<sup>th</sup>, 2014</p></a>
<a class="related-posts-link text-link" href="/authors/dan-mcclain.html">See all 16 posts by Dan</a></div></div><p class='post__tags'><a class="post__tag" href="/categories/ruby.html">Ruby&nbsp;<span class='post__tag__count'>(37)</span></a> <a class="post__tag" href="/categories/testing.html">Testing&nbsp;<span class='post__tag__count'>(6)</span></a> <a class="post__tag" href="/categories/linux.html">Linux&nbsp;<span class='post__tag__count'>(1)</span></a></p><div id='disqus_thread'></div><script>
  var disqus_shortname = 'reefpoints';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script><noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus</a>.</noscript></noscript><script>
  var path = window.location.pathname.split('/').reverse();
  var postname = path[0].split('.');
  var change = postname[0] + '.md';
  var newpath = 'https://github.com/dockyard/reefpoints/blob/master/source/posts/' + path[3] + '-' + path[2] + '-' + path[1] + '-' + change
  $('.post__issue').attr('href', newpath);
</script></div><div class='push--footer'></div><footer><div class='l-wrap'><div class='l-footer-group'><h3 class='footer-group__title'>EVENTS</h3><a class="footer__event--wgr" target="_blank" href="http://wickedgoodruby.com/">Wicked Good Ruby Conf</a><a class="footer__event--ember" target="_blank" href="http://www.meetup.com/Boston-Ember-js/">Boston Ember.js Meetup</a><a class="footer__event--ux" target="_blank" href="http://www.meetup.com/uxboston/">UX Boston Meetup</a><a class="footer__event--openhack" target="_blank" href="http://openhack.github.io/boston/">OpenHack Boston</a></div><div class='l-footer-group'><a href="/"><h3 class='footer-group__title'>BLOG</h3></a>
<a class="footer__post" href="/2014/03/03/using-database-templates.html"><strong>Using Database Templates in Rails</strong><h6 class='footer-desc'>Discover a helpful Postgres config option</h6></a>
<a class="footer__post" href="/2014/03/03/a-simple-ember-data-route.html"><strong>A Simple Ember Data Route</strong><h6 class='footer-desc'>A basic pattern for routes with Ember Data content</h6></a>
<a class="footer__post" href="/2014/02/07/native-app-developers-we-can-help-you.html"><strong>Native App Developers: We Can Help You</strong><h6 class='footer-desc'>Have an existing application? We can help you out!</h6></a></div><div class='l-footer-group'><a href="http://dockyard.com/hire-us"><h3 class='footer-group__title'>CONTACT</h3></a><h6 class='footer-desc'>DockYard HQ is located in Boston. Stop in sometime and meet our team!</h6><a class="footer__address" target="_blank" href="http://goo.gl/maps/zBGfn"><h6>DockYard Inc.<br>101 Tremont Street<br>Suite 200<br>Boston, MA 02108</h6></a>
<a class="text-link" href="http://dockyard.com/hire-us">Get in touch.</a><div class='social-links--footer'><a target="_blank" data-icon="#" class="social-link" href="https://twitter.com/dockyard"><span class='is-hidden'>Twitter</span></a>
<a target="_blank" data-icon="★" class="social-link" href="https://github.com/dockyard"><span class='is-hidden'>GitHub</span></a>
<a target="_blank" data-icon="✒" class="social-link" href="http://reefpoints.dockyard.com/atom.xml"><span class='is-hidden'>RSS</span></a></div></div></div></footer><script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'reefpoints'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script></body></html>
