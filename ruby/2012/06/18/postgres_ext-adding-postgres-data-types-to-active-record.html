<!DOCTYPE html><html><head><title>postgres_ext: Adding Postgres data types to Rails</title><link href="/stylesheets/all-36116f6c.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all-ce68a29a.js" type="text/javascript"></script><meta content='NO-CACHE' http-equiv='CACHE-CONTROL'><meta content='DockYard is a Ruby on Rails, PostgreSQL, and, Ember.js, web / mobile application development software consultancy based in Boston, MA.' namer='description'><meta content='ruby on rails, rails, ruby, ruby on rails training, ruby application development, ruby on rails application development, ember application development, ember.js application development, software application development, web, web application development, mobile, mobile application development, ios, ios application development, iphone, iphone application development, android, android application development, postgres, startups, enterprise, Boston, MA, Massachusetts, for hire' name='keywords'><meta content='web development, mobile development, startups, enterprise, ruby on rails, rails, ruby, ruby on rails training, Boston, for hire' name='keywords'><meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0' name='viewport'><meta charset='utf-8'><meta content='DockYard.com - Announcing postgres_ext, a gem that adds support for PostgreSQL data types to ActiveRecord' name='description'><link href='https://plus.google.com/102648938707671188640' rel='author'><meta content='_danmcclain' name='twitter:creator'><meta content='summary' name='twitter:card'><meta content='@DockYard' name='twitter:site'><meta content='http://reefpoints.dockyard.com/ruby/2012/06/18/postgres_ext-adding-postgres-data-types-to-active-record.html' name='twitter:url'><meta content='postgres_ext: Adding Postgres data types to Rails' name='twitter:title'><meta content='Announcing postgres_ext, a gem that adds support for PostgreSQL data types to ActiveRecord' name='twitter:description'><link href='//cloud.typography.com/6496052/702882/css/fonts.css' rel='stylesheet' type='text/css'><link href='http://dockyard.com/humans.txt' rel='author'><link href='/favicon-573a5e34.png' rel='shortcut icon' type='image/x-icon'><link href='/favicon-573a5e34.png' rel='icon' type='image/x-icon'><link href='/apple-touch-icon.png' rel='apple-touch-icon'><link href='/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'><script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24185112-2']);
    _gaq.push(['_trackPageview']);
  
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
<!--
                                             ..
                                           .O.
                                       .:OO.
                                      :OOO.
                                    :OOO:.
                         ...      :OOOO:
                   ..ZOOOOOOOOO..OZ.O.
                   OOOOOOOOOOOOOOOOI
                  OOOOOOOOOOOOOOOOI,
                 OOOOOOOO. .OOOOOOOO:
                 OOOOOOOO   OOOOOOOOO:
                OOOOOOOOOOOOOOOOOOOOO.
                OOOOOOOOOOOOOOOOOOOOO:
               .OOOOOOOOOOOOOOOOOOOOO:
               .OOOOOOOOOOOOOOOOOOOOO.
                OOOOOOOOOOOOOOOOOOOOO
                OOOOOO?:   .OOOOOOOOO
               .OOOOO      OOOOOOOOOO
,OO ZO,        OOOOO,     OOOOOOOOOO+
 OOOOO.        OOOOO     OOOOOOOOOOO+
  OOO?        OOOOO     .OOOOOOOOOOO:
   OOO,      OOOOO.    .OOOOOOOOOOOO
    OOOOOOOOOOOOO.    .OOOOOOOOOOOO.
     OOOOOOOOOOOO.  .OOOOOOOOOOOOO.
      8OOOOOOOOOOOOOOOOOOOOOOOODO:
         :OOOOOOOOOOOOOOOOOOOO::

--></head><body class='ruby ruby_2012 ruby_2012_06 ruby_2012_06_18 ruby_2012_06_18_postgres_ext-adding-postgres-data-types-to-active-record'><header><div class='extended-nav-wrap'><div class='l-wrap--wide'><nav class='extended-nav'><a class="extended-nav--logo" data-icon="⌂" href="http://dockyard.com/"><span class='is-hidden'>Home</span></a>
<a class="extended-nav--close" data-icon="X" href="#"><span class='is-hidden'>Close</span></a><div class='extended-nav__items'><div class='extended-nav__items--mobile'><a class="extended-nav__item--work extended-nav__item" href="#">Work</a><nav class='work-nav--mobile'><a href="http://dockyard.com/work/credit-card-reviews" class="work-nav-item"><strong class='work-nav-item__title'>Credit Card Reviews</strong></a>
<a href="http://dockyard.com/work/coachup" class="work-nav-item"><strong class='work-nav-item__title'>CoachUp</strong></a>
<a href="http://dockyard.com/work/askthem" class="work-nav-item"><strong class='work-nav-item__title'>AskThem</strong></a>
<a href="http://dockyard.com/work/beacon-hill-blitz" class="work-nav-item"><strong class='work-nav-item__title'>Beacon Hill Blitz</strong></a></nav></div><a class="extended-nav__item" href="http://dockyard.com/team">Our Team</a><a class="extended-nav__item" href="http://dockyard.com/process">Process</a><a class="extended-nav__item" href="http://dockyard.com/community">Community</a><a class="extended-nav__item active" href="/">Blog</a><a class="extended-nav__item" href="http://dockyard.com/hire-us">Hire Us</a></div></nav><nav class='work-nav'><h6>Selected Work</h6><a href="http://dockyard.com/work/credit-card-reviews" class="work-nav-item"><strong class='work-nav-item__title'>Credit Card Reviews</strong><p>Credit card advice from real people.</p></a>
<a href="http://dockyard.com/work/coachup" class="work-nav-item"><strong class='work-nav-item__title'>CoachUp</strong><p>You should be training. Right now.</p></a>
<a href="http://dockyard.com/work/askthem" class="work-nav-item"><strong class='work-nav-item__title'>AskThem</strong><p>Ask officials questions on city, state, and federal levels.</p></a>
<a href="http://dockyard.com/work/beacon-hill-blitz" class="work-nav-item"><strong class='work-nav-item__title'>Beacon Hill Blitz</strong><p>How technology helped repeal the #TechTax.</p></a></nav></div></div><nav class='main-nav-wrap'><div class='main-nav l-wrap--wide'><a class="logo" href="http://dockyard.com">DockYard</a><a class="club-sandwich" data-icon="☰" href="#"><span class='is-hidden'>Navigation</span></a></div></nav></header><div class='push--header'></div><div class='l-wrap--blog'><a href="/"><strong class='logo--blog'>ReefPoints</strong><strong class='logo--blog__tagline'>Blog</strong></a><nav class='blog-nav'><a class="blog-nav__item " href="/">Posts</a><a class="blog-nav__item " href="/categories.html">Categories</a><a class="blog-nav__item " href="/authors.html">Authors</a></nav></div><div class='l-wrap--blog__post'><a class='ad--ruby' href='http://wickedgoodruby.com' target='_blank'><strong class='ad__text'>Don&rsquo;t miss Wicked Good Ruby Conf in Boston this October 11 &ndash; 12, 2014!</strong></a><h1 class='post__title'>postgres_ext: Adding Postgres data types to Rails</h1><a class="post__author" href="/authors/dan-mcclain.html">Dan McClain</a><time class='post__date'>June 18<sup>th</sup>, 2012</time><div class='post__content'><p>Over the past few weeks, I have been working on a new gem which adds
support to Rail&#39;s ActiveRecord for PostgreSQL&#39;s native data types. I am
happy to announce that I have released the
<a href="https://github.com/dockyard/postgres_ext">postgres_ext</a> gem.</p>

<p>postgres_ext supports for ActiveRecord version 3.2 and above (at this
time). Parallel to my development, I plan to submit pull request to
Rails master, so that postgres_ext will not be needed in Rails 4.0.</p>

<h2>Features</h2>

<h3>Migration/Schema support</h3>

<p>postgres_ext adds migration and <code>schema.rb</code> support for the following
PostgresSQL type:</p>

<ul>
<li>INET</li>
<li>CIDR</li>
<li>MACADDR</li>
<li>UUID</li>
<li>Arrays</li>
</ul>

<p>You can create columns with the following migration methods:</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre>create_table <span class="symbol">:examples</span> <span class="keyword">do</span> |t|
  t.inet <span class="symbol">:ip_address</span>
  <span class="comment"># INET Column</span>

  t.cidr <span class="symbol">:subnet</span>
  <span class="comment"># CIDR Column</span>

  t.macaddr <span class="symbol">:mac_address</span>
  <span class="comment"># MACADDR Column</span>

  t.uuid <span class="symbol">:unique_id</span>
  <span class="comment"># UUID Column</span>

  t.integer <span class="symbol">:int_array</span>, <span class="symbol">:array</span> =&gt; <span class="predefined-constant">true</span>
  <span class="comment"># Integer[] Column</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>These migrations will be captured in your <code>schema.rb</code> file, so you don&#39;t
have to use the <code>structure.sql</code> file if these types are your only reason. In
fact, if you are using these only supported types with <code>structure.sql</code>,
including the postgres_ext gem should allow you to correctly <code>rake
db:schema:dump</code> your database.</p>

<p><a href="https://github.com/dockyard/postgres_ext#migrationschemarb-support">Migration/Schema.rb support documentation</a></p>

<h3>Type Casting</h3>

<p>postgres_ext converts INET and CIDR values to
<a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/ipaddr/rdoc/IPAddr.html">IPAddr</a> instances,
 and coverts arrays to array objects of the column type (integer arrays
are cast as an array of integers, INET arrays to are cast to an array of
IPAddrs).</p>

<h3>INET Type Casting example</h3>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre>create_table <span class="symbol">:inet_examples</span> <span class="keyword">do</span> |t|
  t.inet <span class="symbol">:ip_address</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class">InetExample</span> &lt; <span class="constant">ActiveRecord</span>::<span class="constant">Base</span>
<span class="keyword">end</span>

inetExample = <span class="constant">InetExample</span>.new
inetExample.ip_address = <span class="string"><span class="delimiter">'</span><span class="content">127.0.0.0/24</span><span class="delimiter">'</span></span>
inetExample.ip_address
<span class="comment"># =&gt; #&lt;IPAddr: IPv4:127.0.0.0/255.255.255.0&gt;</span>
inetExample.save

inet_2 = <span class="constant">InetExample</span>.first
inet_2.ip_address
<span class="comment"># =&gt; #&lt;IPAddr: IPv4:127.0.0.0/255.255.255.0&gt;</span>
</pre></td>
</tr></table>
</div></div>
<h3>Array Type Casting example</h3>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre>create_table <span class="symbol">:people</span> <span class="keyword">do</span> |t|
  t.integer <span class="symbol">:favorite_numbers</span>, <span class="symbol">:array</span> =&gt; <span class="predefined-constant">true</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class">Person</span> &lt; <span class="constant">ActiveRecord</span>::<span class="constant">Base</span>
<span class="keyword">end</span>

person = <span class="constant">Person</span>.new
person.favorite_numbers = [<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>]
person.favorite_numbers
<span class="comment"># =&gt; [1,2,3]</span>
person.save

person_2 = <span class="constant">Person</span>.first
person_2.favoite_numbers
<span class="comment"># =&gt; [1,2,3]</span>
person_2.favoite_numbers.first.class
<span class="comment"># =&gt; Fixnum</span>
</pre></td>
</tr></table>
</div></div>
<p><a href="https://github.com/dockyard/postgres_ext#type-casting-support">Type casting documentation</a></p>

<h2>Another gem born out of necessity</h2>

<p>I have also released
<a href="https://github.com/dockyard/pg_array_parser">pg_array_parser</a>, a C
extension which parses PostgreSQL array values and returns an array of
strings.  This gem is used by postgres_ext to retrieve the array values
before casting them to the required type.</p>

<h2>Plans for postgres_ext</h2>

<p><a href="http://reefpoints.dockyard.com/ruby/2012/05/18/rails-4-sneak-peek-expanded-activerecord-support-for-postgresql-datatype.html">INET, CIDR and MACADDR support has already been added to Rails 4.</a>
My next step is to submit a pull request to add UUID migration support
and Array support to Rails master.  Then I plan to backport Rails 4&#39;s
hstore support back to postgres_ext. After adding support for the other
PostgreSQL types, I plan to add support to arel for PostgreSQL type
specific where clauses (ie ANY for array comparison, <code>&lt;&lt;</code> and <code>&gt;&gt;</code> for
INET and CIDR comparisons.</p>
</div><div class='post__share'><a class='twitter-share-button' data-url='http://reefpoints.dockyard.com/ruby/2012/06/18/postgres_ext-adding-postgres-data-types-to-active-record.html' data-via='DockYard' href='https://twitter.com/share'>Tweet</a><script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='//platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');
</script><div class='g-plusone' data-href='#' data-size='medium' data-width='100'></div><script>
  (function() {var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;po.src = 'https://apis.google.com/js/plusone.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();
</script><span class='post__share--github'>If you see an issue, please send a <a href='https://github.com/dockyard/reefpoints/blob/master/source/posts/', class='text-link post__issue', target: '_blank'>pull request</a> to contribute.</span></div><div class='related-posts-wrap'><div class='post__avatar-wrap'><img class='post__avatar' src='/images/team/dan-mcclain.jpg'><h5 class='post__avatar__name'>Dan McClain</h5><h5 class='post__avatar__position headline--sub'>Partner &amp; Developer At DockYard
</h5><nav class='post__avatar__social-links'><a target="_blank" class="post__avatar__social-link--twitter" data-icon="#" href="http://twitter.com/_danmcclain">_danmcclain</a><a target="_blank" class="post__avatar__social-link--github" data-icon="★" href="https://github.com/danmcclain">danmcclain</a></nav></div><div class='related-posts'><h3 class='related-posts__header headline--sub'>Other posts by Dan</h3><a class="related-post" href="/2014/05/27/avoid-rails-when-generating-json-responses-with-postgresql.html"><h2 class='related-post__title'>Avoid Rails When Generating JSON responses with PostgreSQL</h2><p>May 27<sup>th</sup>, 2014</p></a>
<a class="related-post" href="/2014/02/07/native-app-developers-we-can-help-you.html"><h2 class='related-post__title'>Native App Developers: We Can Help You</h2><p>February 7<sup>th</sup>, 2014</p></a>
<a class="related-posts-link text-link" href="/authors/dan-mcclain.html">See all 17 posts by Dan</a></div></div><p class='post__tags'><a class="post__tag" href="/categories/ruby.html">Ruby&nbsp;<span class='post__tag__count'>(45)</span></a> <a class="post__tag" href="/categories/postgresql.html">PostgreSQL&nbsp;<span class='post__tag__count'>(12)</span></a> <a class="post__tag" href="/categories/ruby-on-rails.html">Ruby on Rails&nbsp;<span class='post__tag__count'>(36)</span></a> <a class="post__tag" href="/categories/gems.html">Gems&nbsp;<span class='post__tag__count'>(10)</span></a></p><div id='disqus_thread'></div><script>
  var disqus_shortname = 'reefpoints';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script><noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus</a>.</noscript></noscript><script>
  var path = window.location.pathname.split('/').reverse();
  var postname = path[0].split('.');
  var change = postname[0] + '.md';
  var newpath = 'https://github.com/dockyard/reefpoints/blob/master/source/posts/' + path[3] + '-' + path[2] + '-' + path[1] + '-' + change
  $('.post__issue').attr('href', newpath);
</script></div><div class='push--footer'></div><footer><div class='l-wrap'><div class='l-footer-group'><h3 class='footer-group__title'>EVENTS</h3><a class="footer__event--wgr" target="_blank" href="http://wickedgoodruby.com/">Wicked Good Ruby Conf</a><a class="footer__event--ember" target="_blank" href="http://www.meetup.com/Boston-Ember-js/">Boston Ember.js Meetup</a><a class="footer__event--ux" target="_blank" href="http://www.meetup.com/uxboston/">UX Boston Meetup</a><a class="footer__event--openhack" target="_blank" href="http://openhack.github.io/boston/">OpenHack Boston</a></div><div class='l-footer-group'><a href="/"><h3 class='footer-group__title'>BLOG</h3></a>
<a class="footer__post" href="/2014/06/24/introducing_ember_cli_addons.html"><strong>Introducing Ember CLI Addons</strong><h6 class='footer-desc'></h6></a>
<a class="footer__post" href="/2014/06/23/kapow-using-framer.html"><strong>KAPOW! Writing prototypes with Framer</strong><h6 class='footer-desc'>A look at Framer.js, a powerful prototyping tool.</h6></a>
<a class="footer__post" href="/2014/06/23/goodbye-heroku.html"><strong>Goodbye Heroku</strong><h6 class='footer-desc'>Done with them</h6></a></div><div class='l-footer-group'><a href="http://dockyard.com/hire-us"><h3 class='footer-group__title'>CONTACT</h3></a><h6 class='footer-desc'>DockYard HQ is located in Boston. Stop in sometime and meet our team!</h6><a class="footer__address" target="_blank" href="http://goo.gl/maps/zBGfn"><h6>DockYard Inc.<br>101 Tremont Street<br>Suite 200<br>Boston, MA 02108</h6></a>
<a class="text-link" href="http://dockyard.com/hire-us">Get in touch.</a><div class='social-links--footer'><a target="_blank" data-icon="#" class="social-link" href="https://twitter.com/dockyard"><span class='is-hidden'>Twitter</span></a>
<a target="_blank" data-icon="★" class="social-link" href="https://github.com/dockyard"><span class='is-hidden'>GitHub</span></a>
<a target="_blank" data-icon="✒" class="social-link" href="http://reefpoints.dockyard.com/atom.xml"><span class='is-hidden'>RSS</span></a></div></div></div></footer><script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'reefpoints'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script></body></html>
