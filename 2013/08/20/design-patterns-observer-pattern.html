<!DOCTYPE html><html><head><title>Design Patterns: The Observer Pattern</title><link href="/stylesheets/all-2a590f9f.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all-d0af4672.js" type="text/javascript"></script><meta content='NO-CACHE' http-equiv='CACHE-CONTROL'><meta content='DockYard is a Ruby on Rails, PostgreSQL, and, Ember.js, web / mobile application development software consultancy based in Boston, MA.' namer='description'><meta content='ruby on rails, rails, ruby, ruby on rails training, ruby application development, ruby on rails application development, ember application development, ember.js application development, software application development, web, web application development, mobile, mobile application development, ios, ios application development, iphone, iphone application development, android, android application development, postgres, startups, enterprise, Boston, MA, Massachusetts, for hire' name='keywords'><meta content='web development, mobile development, startups, enterprise, ruby on rails, rails, ruby, ruby on rails training, Boston, for hire' name='keywords'><meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0' name='viewport'><meta content='DockYard.com - NSA Edition: Exploring design patterns and their use cases' name='description'><meta content='DougYun' name='twitter:creator'><meta content='summary' name='twitter:card'><meta content='@DockYard' name='twitter:site'><meta content='http://reefpoints.dockyard.com/2013/08/20/design-patterns-observer-pattern.html' name='twitter:url'><meta content='Design Patterns: The Observer Pattern' name='twitter:title'><meta content='NSA Edition: Exploring design patterns and their use cases' name='twitter:description'><link href='http://dockyard.com/humans.txt' rel='author'><link href='/apple-touch-icon.png' rel='apple-touch-icon'><link href='/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'><script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24185112-2']);
    _gaq.push(['_trackPageview']);
  
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
<!--
                                                                    ..
                                                                 ,Z+O.
                                                              .OO.O..
                                                             OZ..O.
                                                         ..OO..87.
                                                        .O7O..O...
                                                      .O...Z~O.
                                                   .:Z~. ..Z..
                                                  +O.O   .8..
                                     ...       .OO.  O  O?.
                             ..ZOOOOOOOOOZOOO.ZOZ.   .OO..
                           .OOOOOOOOOOOOOOOOOO..Z.   $O.
                         .ZOOOOOOOOOOOOOOOOOO.  .O..O.
                        .ZOOOOOOOOOOOOOOOOOOOZ  .:O$.
                        OZOOOOOOOOOOO...OOOOOOOZ$ZO
                      ..OOOOOOOOOOOOO  .OOOOOOOOOOO..
                      .OOOOOOOOOOOOOOOOOOOOOOOOOOOOO.
                      .OOOOOOOOOOOOOOOOOOOOOOOOOOOOZ.
                      OOOOOOOOOOOOOOOOOOOOOOOOOOOOOO.
                     .OOOOOOOOOOOOOOOOOOOOOOOOOOOOOO.
                     :OOOOOOOOOOOOOOOOOOOOOOOOOOOOOO.
                     ZOOOOOOOOOOOOOOOOOOOOOOOOOOOOOZ.
                     OOOOOOOOOOOOOOOOOOOOOOOOOOOO7OO.
                     ZOOOOOOOOOOOOOOOOOOOOOOOOOOOOOZ.
                     OOOOOOZOOOOOOOO.ZOOOOOOOOOOO7OO.
                     ZOOOOO.OOOOOOOO.OOOOOOOOOO.  OO.
...     ..           OOOOO.OOOOOOOO.OOOOOOOOO.   .O:
.OOZ...OOO.        ..OOOOO.OOOOOOO.OOOOOOOOZ.    .Z..
.OOOOOOOOO         .ZOOOOO.OOOOO..OOOOOOOO~      .Z
 .OOOOOOO.         .OOOOOO.OZZ..OOOOOOOOO.      .?O
  .OOOOOI.        .OOOOOOO..,ZOOOOOOOOOO..      .O.
   .OOOOZ.      ..ZOOOOOOOOOOOOOOOOOOOO~        .O.
   .OOOOO= .....ZOOOOOOOOOOOOOOOOOOOOOO.      ..O.
   ..OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOZ       .,OO.
    .ZOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO.     ...OO..
     .OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO.   ...OO.
     ..ZOOOOOOOOOOOOOOOOOOOOOOOOOOOO.... OZO..
      ...OOOOOOOOOOOOOOOOOOOOOOOOOOZOOOZO...
          .....~OOOOOOOOOOOOOOOOO:........
                ................
--></head><body id='blog'><header id='mobile-header'><div class='wrap'><a class='header-logo' href='/'>DockYard</a><div class='menu-button'></div></div><ul class='flexnav' data-breakpoint='481' id='mobile-nav'><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='http://dockyard.com'><span class='mobile-nav-icon fontello'>h</span><p class='main-nav-item'>Home</p></a></li><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='http://dockyard.com/work'><span class='mobile-nav-icon fontello'>w</span><p class='main-nav-item'>Work</p></a></li><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='http://dockyard.com/team'><span class='mobile-nav-icon fontello'>p</span><p class='main-nav-item'>Team</p></a></li><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='http://dockyard.com/community'><span class='mobile-nav-icon fontello'>c</span><p class='main-nav-item'>Community</p></a></li><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='/'><span class='mobile-nav-icon fontello'>b</span><p class='main-nav-item'>Blog</p></a></li><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='http://dockyard.com/contact'><span class='mobile-nav-icon fontello'>m</span><p class='main-nav-item'>Contact</p></a></li></ul></header><header id='site-header'><div class='wrap'><h1><a class='header-logo' href='http://dockyard.com'>DockYard</a></h1><ul class='main-nav'><li class='nav-work'><a class='main-nav-item' href='http://dockyard.com/work'>Work</a></li><li class='nav-work'><a class='main-nav-item' href='http://dockyard.com/team'>Team</a></li><li class='nav-work'><a class='main-nav-item' href='http://dockyard.com/community'>Community</a></li><li class='nav-work'><a class='main-nav-item current' href='/'>Blog</a></li><li class='nav-work'><a class='main-nav-item' href='http://dockyard.com/contact'>Contact</a></li></ul></div></header><section id='content'><section id='post'><aside class='post-metas-wrap'><ul class='post-metas'><li class='post-meta'><a class="post-author" href="/authors/doug-yun.html">Doug Yun</a></li><li class='post-meta'><span><a class='link link-in-post fontello' href='http://twitter.com/DougYun' target='_blank'>t</a><a class='link link-in-post fontello' href='https://github.com/duggiefresh' target='_blank'>g</a></span></li><li class='post-meta post-date'>20 Aug 2013</li></ul></aside><div class='post-div'><p class='post-meta post-tags'><a class="tag-link" href="/categories/software-design-patterns.html">Software Design Patterns (4)</a>, <a class="tag-link" href="/categories/ruby.html">Ruby (30)</a></p><div class='post-title-wrap'><h1 class='post-title'>Design Patterns: The Observer Pattern</h1></div><current_page class='post-content'><p>Note: We won&#39;t be going over the Ruby
module
<a href="http://ruby-doc.org/stdlib-2.0/libdoc/observer/rdoc/Observable.html"><em>Observable</em></a>.
Instead, we&#39;ll building out the pattern ourselves.</p>

<h2>Your First Day at the NSA</h2>

<p>Welcome to the National Security Agency, <a href="http://www.forodecostarica.com/attachments/201136d1337091462-los-gringos-se-burlan-de-nuestro-pais-agent-smith.jpg">Agent
Smith</a>.
You have quite an impressive background, and we believe your &quot;go-getter&quot;
attitude will instill a new kind of vigor within the organization.</p>

<p>Your cubicle is down to the left... here are some NDAs for
you to fill out. I&#39;ll swing by your desk in the afternoon and pick them
up from you later. Oh, and before I forget, here is your first assignment.</p>

<p>Go get &#39;em, tiger!</p>

<h2>The First Assignment</h2>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
22
23
24
25
26
27
28
29
</pre></td>
  <td class="code"><pre>Agent Smith
Spook First Class
[REDACTED]
NSA                                                     08-20-[REDACTED]

                     Operation [REDACTED] Observers

Welcome, Agent Smith:

Bluntly, we'd like to track everyone's emails.

Attached are two documents.

The first document will show you the basic structure of a typical email,
and the second document will provide you a basic profile of a suspicious
person.

If there are any questions, please reach me at [REDACTED].

Best of luck,





Agent [REDACTED]
[REDACTED]
[REDACTED]
NSA
</pre></td>
</tr></table>
</div></div><div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="comment"># Document 1:</span>
<span class="comment"># Basic structure of an email</span>

<span class="keyword">module</span> <span class="class">Email</span>
  extend <span class="predefined-constant">self</span>

  <span class="keyword">def</span> <span class="function">send</span>(subject, sender, receiver)
    puts <span class="string"><span class="delimiter">%Q[</span><span class="content">
      Subject: </span><span class="inline"><span class="inline-delimiter">#{</span>subject<span class="inline-delimiter">}</span></span><span class="content">
      From:    </span><span class="inline"><span class="inline-delimiter">#{</span>sender<span class="inline-delimiter">}</span></span><span class="content">@example.com
      To:      </span><span class="inline"><span class="inline-delimiter">#{</span>receiver<span class="inline-delimiter">}</span></span><span class="content">@example.com
      Date:    </span><span class="inline"><span class="inline-delimiter">#{</span><span class="constant">Time</span>.now.asctime<span class="inline-delimiter">}</span></span><span class="content">
    </span><span class="delimiter">]</span></span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div><div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="comment"># Document 2:</span>
<span class="comment"># Characteristics of a suspicious person</span>

<span class="keyword">class</span> <span class="class">Person</span>
  include <span class="constant">Email</span>
  attr_reader <span class="symbol">:name</span>

  <span class="keyword">def</span> <span class="function">initialize</span>(name)
    <span class="instance-variable">@name</span> = name
  <span class="keyword">end</span>

  <span class="keyword">def</span> <span class="function">send_email</span>(subject, receiver)
    <span class="constant">Email</span>.send(subject, name, receiver)
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>As we look through the <code>Email</code> module, we see that it contains
<code>Email.send</code> which takes three arguments: <code>subject</code>, <code>sender</code>, and
<code>receiver</code>.</p>

<p>Gazing at the suspicious <code>Person</code> class, we see that it includes the
<code>Email</code> module. <code>Person#send_email</code> takes two parameters: a subject
and a receiver. <code>Person#name</code> will stand in as the sender of the email.</p>

<p>Hypothetically, let&#39;s see how a suspicious person would send an email:</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre>bill = Person.new 'Bill'
bill.send_email 'Fishing Trip', 'Fred'
  # =&gt;
      Subject: Fishing Trip
      From:    Bill@example.com
      To:      Fred@example.com
      Date:    Wed Aug 16 20:35:09 2006
</pre></td>
</tr></table>
</div></div>
<p>Hmm... as you sit in your cubicle, you ponder the numerous possible ways of
tracking emails. You won&#39;t need anything too complicated, just
something to kick off a notification once an email has been sent.</p>

<p>Volia! You realize you can use the <em>Observer</em> pattern!</p>

<h2>The Subject and its Observers</h2>

<p>First, let&#39;s start off by creating two <em>observer</em> classes,
<code>Alert</code> and <code>Agent</code> classes.</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
</pre></td>
  <td class="code"><pre><span class="keyword">class</span> <span class="class">Alert</span>
  <span class="keyword">def</span> <span class="function">gotcha</span>(person)
    puts <span class="string"><span class="delimiter">&quot;</span><span class="content">!!! ALERT: </span><span class="inline"><span class="inline-delimiter">#{</span>person.name.upcase<span class="inline-delimiter">}</span></span><span class="content"> SENT AN EMAIL !!!</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class">Agent</span>
  <span class="keyword">def</span> <span class="function">gotcha</span>(person)
    puts <span class="string"><span class="delimiter">&quot;</span><span class="content">!!! TIME TO DETAIN </span><span class="inline"><span class="inline-delimiter">#{</span>person.name.upcase<span class="inline-delimiter">}</span></span><span class="content"> !!!</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>Next, let&#39;s create a <code>Subject</code> module.</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
</pre></td>
  <td class="code"><pre><span class="keyword">module</span> <span class="class">Subject</span>
  attr_reader <span class="symbol">:observers</span>

  <span class="keyword">def</span> <span class="function">initialize</span>
    <span class="instance-variable">@observers</span> = []
  <span class="keyword">end</span>

  <span class="keyword">def</span> <span class="function">add_observer</span>(*observers)
    observers.each { |observer| <span class="instance-variable">@observers</span> &lt;&lt; observer }
  <span class="keyword">end</span>

  <span class="keyword">def</span> <span class="function">delete_observer</span>(*observers)
    observers.each { |observer| <span class="instance-variable">@observers</span>.delete(observer) }
  <span class="keyword">end</span>

  private

  <span class="keyword">def</span> <span class="function">notify_observers</span>
    observers.each { |observer| observer.gotcha(<span class="predefined-constant">self</span>) }
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>Here within the <code>Subject#initialize</code>, we create an empty array which
will contain a list of <em>observers</em>. <code>Subject#add_observer</code> simply pushes
our desired <em>observers</em> into the array.</p>

<p>Finally, we can alter the suspicious <code>Person</code> class, which will act as
the <em>subject</em> class. Let&#39;s include the <code>Subject</code> module now.</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre><span class="keyword">class</span> <span class="class">Person</span>
  include <span class="constant">Email</span>, <span class="constant">Subject</span>
  attr_reader <span class="symbol">:name</span>

  <span class="keyword">def</span> <span class="function">initialize</span>(name)
    <span class="comment"># 'super' requires a parentheses because we're calling</span>
    <span class="comment"># super on the superclass, 'Subject'</span>
    <span class="keyword">super</span>()
    <span class="instance-variable">@name</span> = name
  <span class="keyword">end</span>

  <span class="keyword">def</span> <span class="function">send_email</span>(subject, receiver)
    <span class="constant">Email</span>.send(subject, name, receiver)
    notify_observers
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p><code>Subject#notify_observers</code> calls <code>#gotcha</code> on each <em>observer</em>, which
informs each <em>observer</em> that <code>Person#send_email</code> has been kicked off.</p>

<p>Now let&#39;s give it a whirl...</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre>alert = Alert.new
agent = Agent.new

bill = Person.new 'Bill'

bill.add_observer alert, agent   # Bill now has two observers watching him

bill.send_email 'Fishing Trip', 'Fred'
  # =&gt;
      Subject: Fishing Trip
      From:    Bill@example.com
      To:      Fred@example.com
      Date:    Wed Aug 16 20:35:09 2006

!!! ALERT: BILL SENT AN EMAIL !!!
!!! TIME TO DETAIN BILL !!!
</pre></td>
</tr></table>
</div></div>
<p>Perfect, it works! Now we can start protecting our freedom!</p>

<h2>Discussion</h2>

<p>In our example above, we have two <em>observers</em>, the <code>Alert</code> and <code>Agent</code>
classes, and a <em>subject</em>, <code>Person</code>. By creating the <code>Subject</code> module,
any instance of <code>Person</code> now informs and updates any <em>observer</em> through
<code>#notify_observers</code>, ultimately removing any implicit coupling from <code>Alert</code> and
<code>Agent</code>.</p>

<p>There are a few similarities between the <em>Observer</em> and
<a href="http://reefpoints.dockyard.com/2013/07/25/design-patterns-strategy-pattern.html"><em>Strategy</em></a>
patterns. Both patterns employ an object (the Observer&#39;s <em>subject</em> and
the Strategy&#39;s <em>context</em>) that makes calls to another object (the
Observer&#39;s <em>observer</em> or Strategy&#39;s <em>strategy</em>). The difference between
the two patterns is the purpose and use case. The <em>Strategy</em> pattern
relies on the <em>strategy</em> to do the work, while the <em>Observer</em> pattern
informs the <em>observers</em> of what is going on with the <em>subject</em>.</p>

<p>Hope you enjoyed this short example, thanks for reading!</p>
</current_page><p class='issue'>See a problem with the current page? &nbsp;<a href='https://github.com/dockyard/reefpoints/blob/master/source/posts/' target='_blank'>Send a pull request to contribute, we'll happily accept!</a></p><section class='post-share'><h1>Like the current page? Please share!</h1><div class='social-button'><a class='twitter-share-button' data-url='http://reefpoints.dockyard.com/2013/08/20/design-patterns-observer-pattern.html' data-via='DockYard' href='https://twitter.com/share'>Tweet</a></div><script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='//platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');
</script><div class='social-button'><div class='g-plusone' data-href='#' data-size='medium' data-width='100'></div><script>
  (function() {var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;po.src = 'https://apis.google.com/js/plusone.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();
</script></div></section><section id='post-comments'><div id='disqus_thread'></div><script>
  var disqus_shortname = 'reefpoints';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script><noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript></noscript></section></div></section><script>
  var path = window.location.pathname.split('/').reverse();
  var postname = path[0].split('.');
  var change = postname[0] + '.md';
  var newpath = 'https://github.com/dockyard/reefpoints/blob/master/source/posts/' + path[3] + '-' + path[2] + '-' + path[1] + '-' + change
  $('.issue a').attr('href', newpath);
</script>
</section><footer><ul class='footer-links'><li><a class='link link-in-footer fontello' href='https://github.com/DockYard' target='_blank'>g</a></li><li><a class='link link-in-footer fontello' href='https://twitter.com/DockYard' target='_blank'>t</a></li><li><a class='link link-in-footer fontello' href='http://reefpoints.dockyard.com/atom.xml' target='_blank'>r</a></li><li><a class='link link-in-footer fontello' href='http://dockyard.com/contact' target='_blank'>m</a></li></ul><form class='footer-form'><label class='footer-form-label'>Get in touch with us!</label><input class='footer-form-input' placeholder='Email' type='text'><button class='footer-form-submit fontello' href='http://dockyard.com/contact'>R</button></form><a class='footer-number' href='tel:855-362-5973'>(855) DOCK-YRD</a><p class='footer-copyright'>&copy; 2013 DockYard, LLC. All Rights Reserved.</p></footer><audio class='foghorn' preload='auto' src='/sound/foghorn.mp3'></audio><script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'reefpoints'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script></body></html>
